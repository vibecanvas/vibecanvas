---
import { getCollection } from "astro:content";
import BaseLayout from "./BaseLayout.astro";

type TProps = {
  title: string;
  description: string;
  currentSlug?: string;
};

const { title, description, currentSlug } = Astro.props;
const rawBase = import.meta.env.BASE_URL;
const base = rawBase.endsWith("/") ? rawBase : `${rawBase}/`;

const docs = (await getCollection("docs")).sort(
  (a, b) => a.data.order - b.data.order,
);
---

<BaseLayout title={title} description={description}>
  <div class="shell docs-shell">
    <header class="topbar">
      <a href={base} class="brand" aria-label="Vibecanvas home">
        <span class="brand-wordmark">VIBECANVAS</span>
      </a>
      <nav class="topnav">
        <a href={base}>Home</a>
        <a href={`${base}docs`}>Docs</a>
        <a href="https://github.com/vibecanvas/vibecanvas" target="_blank" rel="noreferrer">GitHub</a>
      </nav>
    </header>

    <div class="docs-grid">
      <aside class="docs-sidebar">
        <p class="sidebar-title">Guides</p>
        <ul>
          {docs.map((entry) => {
            const href = `${base}docs/${entry.slug}`;
            const active = currentSlug === entry.slug;

            return (
              <li>
                <a href={href} class={active ? "is-active" : ""}>
                  {entry.data.title}
                </a>
              </li>
            );
          })}
        </ul>
      </aside>

      <article class="docs-article">
        <slot />
      </article>
    </div>
  </div>
</BaseLayout>
